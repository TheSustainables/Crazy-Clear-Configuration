@using System.Dynamic
@using System.Collections

@foreach (var (key, value) in Config) {
    if (value is ExpandoObject) {
        <MudTreeViewItem Value="@key" UserAttributes="@GetAttributes(key)">
            <NestableConfiguartionTree config="@value" ParentKey="@GetParentKey(key)" filter="@Filter"/>
        </MudTreeViewItem>
    }
    else if (value is IList) {
        <MudTreeViewItem Value="@key" UserAttributes="@GetAttributes(key)">
            @foreach (var listItem in (IEnumerable) value!) {
                <MudTreeViewItem Value="listItem"/>
            }
        </MudTreeViewItem>
    }
    else if(!string.IsNullOrWhiteSpace(Filter) && GetParentKey(key).Contains(Filter)) {
        <MudTreeViewItem Value="@key">
            <MudTreeViewItem Value="@GetValue(value.ToString())"/>
        </MudTreeViewItem>
    }
}

@code {

    [Parameter]
    public ExpandoObject Config { get; set; }

    [Parameter]
    public string ParentKey { get; set; }

    [Parameter]
    public string Filter { get; set; }

    private Dictionary<string, object> GetAttributes(string key) {
        return new Dictionary<string, object>() {
            {"data-key", GetParentKey(key)}
        };
    }
    
    private string GetParentKey(string key) {
        return $"{ParentKey ?? ""}{key}";
    }

    private string GetValue(string value) {
        return $"{value} {Filter}";
    }
}